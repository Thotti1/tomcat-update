- name: stop alfresco service
  systemd:
    name: alfresco
    state: stop

- name: download tomcat apache package
  get_url:
    url: https://dlcdn.apache.org/tomcat/tomcat-8/v{{ tomcat_ver }}/bin/apache-tomcat-{{ tomcat_ver }}.tar.gz
    dest: /opt/app/alfresco/

-name: change directory
 command:
    - cd /opt/app/alfresco/
    - sha512sum apache-tomcat-{{ tomcat_ver }}.tar.gz
    - tar zxf apache-tomcat-{{ tomcat_ver }}.tar.gz

- name: Create directory to take backup
  file:
    path: /opt/app/alfresco/tomcat-backup{{ time }}
    state: directory

- name: taking backup
  copy:
    src: /opt/app/alfresco/tomcat/
    dest: tomcat-backup{{ time }}/

- name: backup
  command: cp -vpr tomcat/{lib,bin,conf,BUILDING.txt,CONTRIBUTING.md,LICENSE,NOTICE,README.md,RELEASE-NOTES,RUNNING.txt} tomcat-backup{{ time }}/

- name: taking backup
  copy:
    src: /opt/app/alfresco/apache-tomcat-{{ tomcat_ver }}/
    dest: /opt/app/alfresco/tomcat/

- name: copying files to tomcat
  command: \cp -vprf apache-tomcat-{{ tomcat_ver }}/{lib,bin,BUILDING.txt,CONTRIBUTING.md,LICENSE,NOTICE,README.md,RELEASE-NOTES,RUNNING.txt} tomcat/

- name: changing permissions
  command : chown -R alfresco:alfresco  tomcat/{lib,bin,BUILDING.txt,CONTRIBUTING.md,LICENSE,NOTICE,README.md,RELEASE-NOTES,RUNNING.txt}

- name: removing files
  command: rm -rf tomcat/{temp,work}/*

- name: Create directory for log backup
  file:
    path: /opt/app/alfresco/logs.old
    state: directory

- name: moving logs to backup folder
  command: mv -vf tomcat/logs/* tomcat/logs.old/

- name: Start alfresco service
  systemd:
     name: alfresco
     state: started